---
title: "tf-func-scope"
author: "Fateema Bazzi"
date: "2025-01-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Project Description
TBD

## Libraries
```{r}
library(tidyverse)
library(ggplot2)
```

## Data Sources
```{r}
gene_func_cat <- read.csv("E_coli_data/annotations/cog-24_Ecoli.cog.csv", header = FALSE)
gene_func_cat <-gene_func_cat[,c(1,7)]
head(gene_func_cat)
```
```{r}
cog_to_func_cat <- read.table("E_coli_data/annotations/cog-24.def.tab", sep = "\t")
cog_to_func_cat <- cog_to_func_cat[,1:2]
head(cog_to_func_cat)
```
```{r}
reg_net <- read.table("network_tf_gene_Ecoli_GRN.txt", skip=37, sep="\t")
reg_net <- reg_net[,c(2,4)]
colnames(reg_net)<- c("TF", "Target")
reg_net[,1]<-tolower(reg_net[,1])
reg_net[,2] <- tolower(reg_net[,2])
head(reg_net)
```
```{r}
id_to_bid <- read_tsv("GeneProductSet.txt", skip=41, col_names = FALSE)
id_to_bid <- id_to_bid[,2:3]
colnames(id_to_bid) <- c("name","bnumber")
id_to_bid$name <- tolower(id_to_bid$name)
head(id_to_bid)
```
#Functional category preprocessing
## Add Functional Categories to Genes
```{r}
# Rename columns for clarity
colnames(cog_to_func_cat) <- c("COG", "FunctionCategory")
colnames(gene_func_cat)[2] <- "COG"  # Assuming the 2nd column has the COG values

# Merge by "COG" to map functional categories, preserving all rows in gene_func_cat
gene_func_cat <- merge(gene_func_cat, cog_to_func_cat, by = "COG", all.x = TRUE)

#exclude genes with no associated functional category
gene_func_cat <- na.omit(gene_func_cat)

# Display the first few rows
head(gene_func_cat)
```

## Remove duplicate rows
```{r}
#duplicates are considered rows with the same gene and functional
#category, not necessarily the same COGID
gene_func_cat <- gene_func_cat[!duplicated(gene_func_cat[,2:3]),]
#TODO: figure out how to deal with the remaining duplicate genes
```

#Regulatory Network Preprocessing
##Switch to bnumbers
```{r}
# Temporarily rename column
colnames(reg_net)[2] <- "name"

# Merge by "ID"
reg_net <- merge(reg_net, id_to_bid, by = "name", all.x = TRUE)

#exclude genes with no associated bnumber
reg_net <- na.omit(reg_net)

#drop the old ids and rename appropriately
reg_net <- reg_net[,2:3]
colnames(reg_net)[2] <- "Target"

head(reg_net)
```

```{r}
#repeat for the TFs
# Temporarily rename column
colnames(reg_net)[1] <- "name"

# Merge by "ID"
reg_net <- merge(reg_net, id_to_bid, by = "name", all.x = TRUE)

#exclude genes with no associated bnumber
reg_net <- na.omit(reg_net)

#drop the old ids and rename appropriately
reg_net <- reg_net[,2:3]
colnames(reg_net)[2] <- "TF"

# Display the first few rows
head(reg_net)
```
##Remove Duplicates
```{r}
reg_net <- reg_net[!duplicated(reg_net),]
```

##Reformat the network table and keep only TFs with >20 targets
```{r}
reg_net_final <- list()
i=1
for (tf in names(which(table(reg_net$TF)>20))){
  reg_net_final[[i]]<- list(TF=tf, Targets=reg_net[which(reg_net$TF==tf),1])
  i=i+1
}
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
